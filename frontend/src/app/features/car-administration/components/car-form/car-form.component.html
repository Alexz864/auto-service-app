<form [formGroup]="carForm" (ngSubmit)="onSubmit()">
  <div class="row mb-3">
    <div class="col-md-12">
      <div class="form-floating">
        <select
          class="form-select"
          id="clientId"
          formControlName="clientId"
          [ngClass]="{'is-invalid': carForm.get('clientId')?.invalid && carForm.get('clientId')?.touched}"
        >
          <option [ngValue]="null" disabled>Selectați proprietarul mașinii</option>
          <option *ngFor="let client of clients" [value]="client.id">
            {{ client.last_name }} {{ client.first_name }}
          </option>
        </select>
        <label for="clientId">Proprietar*</label>
        <div class="invalid-feedback" *ngIf="carForm.get('clientId')?.invalid && carForm.get('clientId')?.touched">
          <span *ngIf="carForm.get('clientId')?.errors?.['required']">Selectați proprietarul mașinii.</span>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-3">
    <div class="col-md-6">
      <div class="form-floating">
        <input
          type="text"
          class="form-control"
          id="registrationNumber"
          formControlName="registrationNumber"
          placeholder="Număr înmatriculare"
          [ngClass]="{'is-invalid': carForm.get('registrationNumber')?.invalid && carForm.get('registrationNumber')?.touched}"
        >
        <label for="registrationNumber">Număr înmatriculare*</label>
        <div class="invalid-feedback" *ngIf="carForm.get('registrationNumber')?.invalid && carForm.get('registrationNumber')?.touched">
          <span *ngIf="carForm.get('registrationNumber')?.errors?.['required']">Numărul de înmatriculare este obligatoriu.</span>
          <span *ngIf="carForm.get('registrationNumber')?.errors?.['pattern']">Format invalid. Exemplu: B 123 ABC sau MM 12 ABC.</span>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="form-floating">
        <input
          type="text"
          class="form-control"
          id="chassisSeries"
          formControlName="chassisSeries"
          placeholder="Serie șasiu"
          [ngClass]="{'is-invalid': carForm.get('chassisSeries')?.invalid && carForm.get('chassisSeries')?.touched}"
        >
        <label for="chassisSeries">Serie șasiu*</label>
        <div class="invalid-feedback" *ngIf="carForm.get('chassisSeries')?.invalid && carForm.get('chassisSeries')?.touched">
          <span *ngIf="carForm.get('chassisSeries')?.errors?.['required']">Seria de șasiu este obligatorie.</span>
          <span *ngIf="carForm.get('chassisSeries')?.errors?.['minlength'] || carForm.get('chassisSeries')?.errors?.['maxlength']">Seria de șasiu trebuie să aibă exact 17 caractere.</span>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-3">
    <div class="col-md-6">
      <div class="form-floating">
        <input
          type="text"
          class="form-control"
          id="brand"
          formControlName="brand"
          placeholder="Marcă"
          [ngClass]="{'is-invalid': carForm.get('brand')?.invalid && carForm.get('brand')?.touched}"
        >
        <label for="brand">Marcă*</label>
        <div class="invalid-feedback" *ngIf="carForm.get('brand')?.invalid && carForm.get('brand')?.touched">
          <span *ngIf="carForm.get('brand')?.errors?.['required']">Marca este obligatorie.</span>
          <span *ngIf="carForm.get('brand')?.errors?.['minlength']">Marca trebuie să aibă cel puțin 2 caractere.</span>
          <span *ngIf="carForm.get('brand')?.errors?.['maxlength']">Marca nu poate depăși 50 de caractere.</span>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="form-floating">
        <input
          type="text"
          class="form-control"
          id="model"
          formControlName="model"
          placeholder="Model"
          [ngClass]="{'is-invalid': carForm.get('model')?.invalid && carForm.get('model')?.touched}"
        >
        <label for="model">Model*</label>
        <div class="invalid-feedback" *ngIf="carForm.get('model')?.invalid && carForm.get('model')?.touched">
          <span *ngIf="carForm.get('model')?.errors?.['required']">Modelul este obligatoriu.</span>
          <span *ngIf="carForm.get('model')?.errors?.['minlength']">Modelul trebuie să aibă cel puțin 1 caracter.</span>
          <span *ngIf="carForm.get('model')?.errors?.['maxlength']">Modelul nu poate depăși 50 de caractere.</span>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-3">
    <div class="col-md-4">
      <div class="form-floating">
        <input
          type="number"
          class="form-control"
          id="yearOfManufacture"
          formControlName="yearOfManufacture"
          placeholder="An fabricație"
          [ngClass]="{'is-invalid': carForm.get('yearOfManufacture')?.invalid && carForm.get('yearOfManufacture')?.touched}"
        >
        <label for="yearOfManufacture">An fabricație*</label>
        <div class="invalid-feedback" *ngIf="carForm.get('yearOfManufacture')?.invalid && carForm.get('yearOfManufacture')?.touched">
          <span *ngIf="carForm.get('yearOfManufacture')?.errors?.['required']">Anul fabricației este obligatoriu.</span>
          <span *ngIf="carForm.get('yearOfManufacture')?.errors?.['min']">Anul fabricației trebuie să fie după 1950.</span>
          <span *ngIf="carForm.get('yearOfManufacture')?.errors?.['max']">Anul fabricației nu poate fi în viitor.</span>
        </div>
      </div>
    </div>
    <div class="col-md-8">
      <div class="form-floating">
        <select
          class="form-select"
          id="engineType"
          formControlName="engineType"
          [ngClass]="{'is-invalid': carForm.get('engineType')?.invalid && carForm.get('engineType')?.touched}"
        >
          <option *ngFor="let type of engineType" [value]="type">
            {{ type | titlecase }}
          </option>
        </select>
        <label for="engineType">Tip motorizare*</label>
        <div class="invalid-feedback" *ngIf="carForm.get('engineType')?.invalid && carForm.get('engineType')?.touched">
          <span *ngIf="carForm.get('engineType')?.errors?.['required']">Tipul motorizării este obligatoriu.</span>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-3">
    <div class="col-md-4">
      <div class="form-floating">
        <input
          type="number"
          class="form-control"
          id="engineCapacity"
          formControlName="engineCapacity"
          placeholder="Capacitate motor (cm³)"
          [ngClass]="{'is-invalid': carForm.get('engineCapacity')?.invalid && carForm.get('engineCapacity')?.touched}"
        >
        <label for="engineCapacity">Capacitate motor (cm³)*</label>
        <div class="invalid-feedback" *ngIf="carForm.get('engineCapacity')?.invalid && carForm.get('engineCapacity')?.touched">
          <span *ngIf="carForm.get('engineCapacity')?.errors?.['required']">Capacitatea motorului este obligatorie.</span>
          <span *ngIf="carForm.get('engineCapacity')?.errors?.['min']">Capacitatea trebuie să fie mai mare de 0.</span>
          <span *ngIf="carForm.get('engineCapacity')?.errors?.['max']">Capacitatea maximă este 10000 cm³.</span>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="form-floating">
        <input
          type="number"
          class="form-control"
          id="horsePower"
          formControlName="horsePower"
          placeholder="Cai putere (CP)"
          [ngClass]="{'is-invalid': carForm.get('horsePower')?.invalid && carForm.get('horsePower')?.touched}"
          (blur)="onHorsePowerChange()"
        >
        <label for="horsePower">Cai putere (CP)*</label>
        <div class="invalid-feedback" *ngIf="carForm.get('horsePower')?.invalid && carForm.get('horsePower')?.touched">
          <span *ngIf="carForm.get('horsePower')?.errors?.['required']">Puterea motorului este obligatorie.</span>
          <span *ngIf="carForm.get('horsePower')?.errors?.['min']">Puterea trebuie să fie mai mare de 0.</span>
          <span *ngIf="carForm.get('horsePower')?.errors?.['max']">Puterea maximă este 2000 CP.</span>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="form-floating">
        <input
          type="number"
          class="form-control"
          id="kW"
          formControlName="kW"
          placeholder="Putere (kW)"
          [ngClass]="{'is-invalid': carForm.get('kW')?.invalid && carForm.get('kW')?.touched}"
          (blur)="onKwChange()"
        >
        <label for="kW">Putere (kW)*</label>
        <div class="invalid-feedback" *ngIf="carForm.get('kW')?.invalid && carForm.get('kW')?.touched">
          <span *ngIf="carForm.get('kW')?.errors?.['required']">Puterea motorului este obligatorie.</span>
          <span *ngIf="carForm.get('kW')?.errors?.['min']">Puterea trebuie să fie mai mare de 0.</span>
          <span *ngIf="carForm.get('kW')?.errors?.['max']">Puterea maximă este 1500 kW.</span>
        </div>
      </div>
    </div>
  </div>

  <div class="mb-3">
    <div class="form-switch d-flex align-items-center">
      <input class="form-check-input me-2" type="checkbox" role="switch" formControlName="activa" id="activa">
      <label class="form-check-label" for="activa">Mașină activă</label>
    </div>
  </div>

  <div class="d-grid gap-2 d-md-flex justify-content-md-end">
    <button type="submit" class="btn btn-primary" [disabled]="loading">
      <span *ngIf="loading" class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
      Salvează
    </button>
  </div>
</form>
